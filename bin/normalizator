#!/usr/bin/env php
<?php

declare(strict_types=1);

require __DIR__ . '/../vendor/autoload.php';

use Normalizator\ConfigurationResolver;
use Normalizator\Console\Application;
use Normalizator\Console\Command\CheckCommand;
use Normalizator\Console\Command\FixCommand;
use Normalizator\FilterFactory;
use Normalizator\Finder\Finder;
use Normalizator\NormalizationFactory;
use Normalizator\Normalizator;
use Normalizator\Observer\NormalizationObserver;
use Normalizator\Util\Timer;
use Normalizator\Util\EolDiscovery;
use Normalizator\Util\FilenameResolver;
use Normalizator\Util\GitDiscovery;
use Normalizator\Util\Slugify;

$timer = new Timer();

$finder = new Finder();
$gitDiscovery = new GitDiscovery();
$eolDiscovery = new EolDiscovery($gitDiscovery);
$slugify = new Slugify();
$filterFactory = new FilterFactory($finder, $gitDiscovery);
$normalizationObserver = new NormalizationObserver();
$filenameResolver = new FilenameResolver();

$normalizationFactory = new NormalizationFactory(
    $finder,
    $slugify,
    $eolDiscovery,
    $gitDiscovery,
    $filenameResolver,
    $filterFactory,
    $normalizationObserver,
);

$normalizator = new Normalizator(
    $normalizationFactory,
    $normalizationObserver,
);

$configurationResolver = new ConfigurationResolver($eolDiscovery);

$application = new Application('Normalizator', Normalizator::VERSION);

$application->add(new CheckCommand(
    $configurationResolver,
    $finder,
    $normalizator,
    $timer,
));

$application->add(new FixCommand(
    $configurationResolver,
    $finder,
    $normalizator,
    $timer,
));

$application->run();
